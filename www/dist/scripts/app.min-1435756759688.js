function connectWithPort(t){return url="ws://localhost:"+t}function Util(){return this.updatesignalimage=function(t){return t.image=Math.abs(t.rssi)<10?"images/signal_5@2x.png":Math.abs(t.rssi)<30?"images/signal_4@2x.png":Math.abs(t.rssi)<50?"images/signal_3@2x.png":Math.abs(t.rssi)<70?"images/signal_2@2x.png":"images/signal_1@2x.png",t},this.hex2a=function(t){var e="";if(t)for(var r=t.toString(),i=0;i<r.length;i+=2)e+=String.fromCharCode(parseInt(r.substr(i,2),16));return e},this.hex2dec=function(t){var e="";return t&&(e=parseInt(t,16)),e},this.hex2b=function(t){var e=hex2i(t);return e.toString(2)},this.a2hex=function(t){var e="";for(a=0;a<t.length;a++)e+=t.charCodeAt(a).toString(16);return e},this.dec2hex=function(t){for(var e=Number(t).toString(16);e.length<2;)e="0"+e;return e},this.show_alert=function(t){$("#customalert").addClass("alert-show"),$(".alert-box").show(),$("#alertmessage").html(t)},this.hide_alert=function(){$("#customalert").removeClass("alert-show"),$(".alert-box").hide()},this}var app=angular.module("GATT-IP",["ngRoute"]).config(["$routeProvider",function(t){t.when("/devicelist",{templateUrl:"views/devicelist.html",controller:"devicelistController"}),t.when("/servicelist",{templateUrl:"views/servicelist.html",controller:"servicelistController"}),t.when("/characteristiclist",{templateUrl:"views/characteristiclist.html",controller:"characteristiclistController"}),t.when("/descriptorlist",{templateUrl:"views/descriptorlist.html",controller:"descriptorlistController"}),t.otherwise({redirectTo:"/devicelist"})}]);app.controller("AlertController",["$scope","gattip",function(t){t.hide_alert=function(){var t=Util();t.hide_alert()}}]),app.controller("characteristiclistController",["$scope","gattip",function(t,e){t.gattip=e,t.discoverDescriptors=function(t){t.discoverDescriptors()},t.back=function(){history.go(-1)},t.gotologview=function(){window.location="gatt-ip://logview"}}]),app.controller("descriptorlistController",["$scope","gattip",function(t,e){function r(){switch(t.readformat){case"1":t.currentValue=i.hex2a(e.currentCharacteristic.value);break;case"2":t.currentValue=i.hex2dec(e.currentCharacteristic.value);break;case"3":t.currentValue=i.hex2b(e.currentCharacteristic.value);break;default:t.currentValue=e.currentCharacteristic.value}}t.gattip=e;var i=Util();t.readformat=0,t.writeformat=0,t.$watch("gattip.currentCharacteristic.value",r),t.changeFormat=r,t.writeValue=function(){if(!t.inputs)return void i.show_alert("Please enter value to write.");var r="";switch(t.writeformat){case"1":r=i.a2hex(t.inputs);break;case"2":r=i.dec2hex(t.inputs);break;case"3":r=t.inputs;break;default:r=t.inputs}e.currentCharacteristic.write(r)},t.readAgain=function(){e.currentCharacteristic.read()},t.notify=function(){e.currentCharacteristic.notify(!0)},t.stopNotify=function(){e.currentCharacteristic.notify(!1)},t.back=function(){history.go(-1)},t.gotologview=function(){window.location="gatt-ip://logview"}}]),app.controller("devicelistController",["$scope","gattip",function(t,e){function r(e){t.name=e.name,t.uuid=e.uuid,t.discoverable=e.discoverable,t.txpowerLevel=e.txpowerLevel,t.serviceUUIDs=e.serviceUUIDs,t.rssi=e.rssi}t.gattip=e,t.showData=function(e){t.showformat=0,r(e),t.manufacturerData=e.manufacturerData,t.rawAdvertisingData=e.rawAdvertisingData,t.peripheral1=e},t.changeDataFormat=function(e){var i=Util();switch(r(t.peripheral1),e.showformat){case"1":t.manufacturerData=i.hex2a(t.peripheral1.manufacturerData),t.rawAdvertisingData=i.hex2a(t.peripheral1.rawAdvertisingData);break;case"2":t.manufacturerData=i.hex2dec(t.peripheral1.manufacturerData),t.rawAdvertisingData=i.hex2dec(t.peripheral1.rawAdvertisingData);break;default:t.manufacturerData=t.peripheral1.manufacturerData,t.rawAdvertisingData=t.peripheral1.rawAdvertisingData}},t.connectPeripheral=function(t){e.stopScan(),setTimeout(function(){t.connect()},500)},t.gotoremoteview=function(){window.location="gatt-ip://remoteview"},t.gotologview=function(){window.location="gatt-ip://logview"},$(document).ready(function(){var r,i,a,n=$(".PullToRefresh"),o=!1,c=document.documentElement;$.each(n,function(n,s){s.addEventListener("touchstart",function(t){$(".pull").hide(),contentStartY=$(".iscroll-scroller").position().top,r=t.touches[0].screenY,console.log(r),a=(window.pageXOffset||c.scrollLeft)-(c.clientLeft||0),i=(window.pageYOffset||c.scrollTop)-(c.clientTop||0)}),s.addEventListener("touchend",function(){if($(".pull").html("Pull Down").hide(),o){s.style["-webkit-transition-duration"]=".5s",t.$apply(function(){e.peripherals={}});e.scan(!0),s.addEventListener("transitionEnd",l),o=!1}}),s.addEventListener("touchmove",function(t){if(0===i){if(t.changedTouches[0].screenY-r>15&&(t.preventDefault(),$(".pull").html("Pull Down").show()),!(0===i&&t.changedTouches[0].screenY-r>80&&contentStartY>=0))return o=!1,!1;$(".pull").html("Release to Refresh").show(),o=!0}});var l=function(){content.style["-webkit-transition-duration"]=0}}),document.addEventListener("touchend",function(){$(".pull").html("Pull down").hide()},!1)})}]),app.controller("servicelistController",["$scope","gattip",function(t,e){t.gattip=e,t.discoverCharacteristics=function(t){t.discoverCharacteristics()},t.back=function(){e&&e.configure(!0),history.go(-1)},t.gotologview=function(){window.location="gatt-ip://logview"}}]);var url="ws://localhost:6001";app.factory("gattip",["$q","$rootScope","$location",function(t,e,r){var i=Util(),a=new GATTIP;return a.init(url),a.oninit=function(){a.configure(!0)},a.onstate=function(){if(a.state===GATTIP.kPoweredOn){a.scan(!0)}else a.state===GATTIP.kPoweredOff?e.$apply(function(){r.path("/devicelist"),i.show_alert("Please turn on Bluetooth to scan peripherals.")}):a.state===GATTIP.kUnsupported&&i.show_alert("Bluetooth Low Energy is not supported with this device.")},a.onscan=function(t,r){return r?void i.show_alert(r.code+": "+r.message):(i.updatesignalimage(t),void e.$apply())},a.onconnect=function(t,e){return e?void i.show_alert(e.code+": "+e.message):(a.currentPeripheral=t,void t.discoverServices())},a.ondisconnect=function(t,n){a.currentPeripheral=null,n&&n.message&&i.show_alert(n.code+": "+n.message),e.$apply(function(){r.path("/devicelist")})},a.ondiscoverServices=function(t,a){return a?void i.show_alert(a.code+": "+a.message):void e.$apply(function(){r.path("/servicelist")})},a.ondiscoverCharacteristics=function(t,n,o){return o?void i.show_alert(o.code+": "+o.message):(a.currentService=n,void e.$apply(function(){r.path("/characteristiclist")}))},a.ondiscoverDescriptors=function(t,n,o,c){return c?void i.show_alert(c.code+": "+c.message):(a.currentCharacteristic=o,o.properties[1].enabled&&o.read(),void e.$apply(function(){r.path("/descriptorlist")}))},a.onupdateValue=function(t,r,a,n){return n?void i.show_alert(n.code+": "+n.message):void e.$apply()},a.onwriteValue=function(t,r,a,n){return n?void i.show_alert(n.code+": "+n.message):void e.$apply()},a}]),app.filter("orderObjectBy",function(){return function(t,e,r){var i=[];return angular.forEach(t,function(t){i.push(t)}),r?i:(i.sort(function(t,r){return Math.abs(t[e])>Math.abs(r[e])?1:-1}),i)}});