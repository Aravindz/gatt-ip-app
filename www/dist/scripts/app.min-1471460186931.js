function DeviceInfoController(e,r,t){function i(r){e.name=e.peripheral.name,e.uuid=e.peripheral.uuid,e.peripheral.advdata&&void 0!==e.peripheral.advdata?e.discoverable=e.peripheral.advdata.discoverable:e.discoverable=e.peripheral.discoverable,e.peripheral.advdata&&void 0!==e.peripheral.advdata.txPowerLevel?e.txpowerLevel=e.peripheral.advdata.txPowerLevel:e.txpowerLevel=e.peripheral.txPowerLevel,e.peripheral.advdata&&r.advdata.serviceUUIDs.length>0?e.serviceUUIDs=e.peripheral.advdata.serviceUUIDs:e.serviceUUIDs=e.peripheral.getAllAdvertisedServiceUUIDs(),e.peripheral.advdata&&!n.isEmpty(e.peripheral.advdata.manufacturerData)?e.manufacturerData=e.peripheral.advdata.manufacturerData:e.manufacturerData=e.peripheral.getAllMfrData(),0===Object.keys(e.manufacturerData).length&&(e.manufacturerData=void 0),e.rssi=e.peripheral.rssi}e.peripheral=t;var n=new Util;e.showformat="Hex",i(e.peripheral),e.peripheral1=e.peripheral,e.changeDataFormat=function(r){switch(i(e.peripheral1),r.showformat){case"01":e.peripheral1.manufacturerData&&(e.manufacturerData=n.hex2a(e.peripheral1.manufacturerData)),e.peripheral1.rawAdvertisingData&&(e.rawAdvertisingData=n.hex2a(e.peripheral1.rawAdvertisingData));break;case"02":e.peripheral1.manufacturerData&&(e.manufacturerData=n.hex2dec(e.peripheral1.manufacturerData)),e.peripheral1.rawAdvertisingData&&(e.rawAdvertisingData=n.hex2dec(e.peripheral1.rawAdvertisingData));break;default:e.manufacturerData=e.peripheral1.manufacturerData,e.rawAdvertisingData=e.peripheral1.rawAdvertisingData}},e.okClick=function(){r.cancel()}}function LoadingIndicatorController(e,r){e.bleexplorer=bleexplorer,e.bleexplorer.isShowingLoadingIndic=!0,e.loading_text=r}function NoDeviceFoundController(e,r,t){e.loading_text="No devices found with given filters. Do you want to display all near by devices ?",e.bleexplorer=bleexplorer,e.okClick=function(){r.hide(),e.bleexplorer._currentgateway.stopScan(function(){e.bleexplorer.filtername="",e.bleexplorer.filteruuid="",e.bleexplorer.showLoadingIndicator("","Scanning for Peripherals...."),e.bleexplorer.stopScanEvent(e.bleexplorer.filtername,e.bleexplorer.filteruuid),e.bleexplorer._currentgateway.scan(function(){e.bleexplorer._currentgateway.on("scan",e.bleexplorer.onScan),t(function(){(void 0===e.bleexplorer.scanned_perips_length||e.bleexplorer.scanned_perips_length<1)&&e.bleexplorer.filterFound===!1&&(e.bleexplorer.showNoDeviceFoundDialog(),e.bleexplorer.filterFound=!1)},7e3)})})}}function alertDialogController(e,r,t){e.alert_text=t,e.okClick=function(){r.hide()}}function connectWithPort(e){return isGattipApp=!0,url="ws://localhost:"+e}function initialiseGattip(){function e(){this.peripheral={},r=new GATTIP,t=new WebSocket(url),t.onopen=function(){r.open({stream:t})},r.once("state",function(e){window.bleexplorer.showAlert("Please turn on Bluetooth to scan peripherals.")}),r.once("ready",function(e){window.bleexplorer._currentgateway=e,window.bleexplorer.scanStarts(),window.bleexplorer._currentgateway.scan(function(){window.bleexplorer._currentgateway.on("scan",window.bleexplorer.onScan)})}),r.on("error",function(e){console.log(e),window.bleexplorer.isShowingLoadingIndic&&!window.bleexplorer.filterScan&&window.bleexplorer.hideDialog(),e.message.indexOf("Device could not be connected")>0||e.message.indexOf("Timed out while waiting for discovery to complete")>0?window.bleexplorer.showAlert("Device could not be connected! Try again"):e.message.indexOf("Device is disconnected while discovering services")>0?window.bleexplorer.showAlert("Device is disconnected while discovering services.."):e.message.indexOf("Failed to get services")>0?window.bleexplorer.showAlert("Failed to get services. Try again"):e.message.indexOf("Unexpectedly disconnected")>0?(window.bleexplorer.showAlert("Device is disconnected! Try again"),window.bleexplorer.currentPeripheral=null,window.bleexplorer.mainState(),window.bleexplorer.scanStarts(),window.bleexplorer._currentgateway.scan(function(){window.bleexplorer._currentgateway.on("scan",window.bleexplorer.onScan)})):e.message.indexOf("Invalid Length")>0||e.message.indexOf("length is invalid")>0?window.bleexplorer.showAlert("Invalid Length. Please check the entered value"):e.message.indexOf("Timed out")>0?window.bleexplorer.showAlert("Timed out while processing the Request"):e.message.indexOf("Unable to find the requested device")>0&&window.bleexplorer.showAlert("Sorry, unable to find the requested device. Issue a scan first")})}var r,t;window.bleexplorer=new e}function Util(){return this.updatesignalimage=function(e){return e&&e.rssi?(Math.abs(e.rssi)<45?e.image="images/signal_5@2x.png":Math.abs(e.rssi)<55?e.image="images/signal_4@2x.png":Math.abs(e.rssi)<65?e.image="images/signal_3@2x.png":Math.abs(e.rssi)<75?e.image="images/signal_2@2x.png":e.image="images/signal_1@2x.png",e):e},this.pushUniqueObj=function(e,r){var t=!1,i=-1;if("undefined"!=typeof e){for(i=0;i<e.length;i++)if(e[i].uuid===r.uuid){t=!0;break}}else e=[];return t?(e.splice(i,1,r),e):(e.push(r),e)},this.isEmpty=function(e){for(var r in e)if(e.hasOwnProperty(r))return!1;return JSON.stringify(e)===JSON.stringify({})},this.isValidHex=function(e){for(var r=!1,t=0;t<e.length;t++){if("string"!=typeof e[t]||isNaN(parseInt(e[t],16)))return r=!1;r=!0}return r},this.hex2a=function(e){if(e){for(var r=e.toString(),t="",i=0;i<r.length;i+=2)t+=String.fromCharCode(parseInt(r.substr(i,2),16));return t}},this.hex2dec=function(e){return parseInt(e,16)},this.hex2b=function(e){var r=hex2i(e);return r.toString(2)},this.a2hex=function(e){for(var r="",t=0;t<e.length;t++)r+=e.charCodeAt(t).toString(16);return r},this.dec2hex=function(e){for(var r=Number(e).toString(16);r.length<2;)r="0"+r;return r},this}DeviceInfoController.$inject=["$scope","$mdDialog","peripheral"],LoadingIndicatorController.$inject=["$scope","loadingText"],alertDialogController.$inject=["$scope","$mdDialog","alertText"],NoDeviceFoundController.$inject=["$scope","$mdDialog","$timeout"];var app;!function(){app=angular.module("bleExplorerApp",["ngMaterial","ui.router"]).config(["$stateProvider","$urlRouterProvider","$mdThemingProvider",function(e,r,t){e.state("devicelist",{url:"/devicelist",templateUrl:"views/devicelist.html",controller:"devicelistCtrl"}).state("servicelist",{url:"/servicelist",templateUrl:"views/servicelist.html",controller:"servicelistCtrl"}).state("characteristiclist",{url:"/characteristiclist",templateUrl:"views/characteristiclist.html",controller:"characteristiclistCtrl"}).state("descriptorlist",{url:"/descriptorlist",templateUrl:"views/descriptorlist.html",controller:"descriptorlistCtrl"}),r.otherwise("/devicelist"),t.theme("default").primaryPalette("blue").accentPalette("pink"),t.theme("success-toast"),t.theme("error-toast")}])}(),app.run(["$document","$window",function(e,r){var t=e[0];t.addEventListener("click",function(e){var i=t.hasFocus();i||r.focus()})}]),app.controller("characteristiclistCtrl",["$scope","$state",function(e,r){isGattipApp&&(e.isGattipApp=!0),e.bleexplorer=bleexplorer,e.bleexplorer.isNotifying&&e.bleexplorer.currentCharacteristic.enableNotifications(function(r,t){e.bleexplorer.isNotifying=t},!1),e.discoverDescriptors=function(t){e.bleexplorer.currentCharacteristic=t,r.go("descriptorlist")},e.back=function(){history.go(-1)},e.gotologview=function(){window.location="gatt-ip://logview"}}]),app.controller("descriptorlistCtrl",["$scope","$state",function(e,r){isGattipApp&&(e.isGattipApp=!0),e.bleexplorer=bleexplorer,e.readformat="Hex",e.writeformat="Hex";var t=new Util;e.bleexplorer.isNotifying=!1;var i="";e.bleexplorer.currentCharacteristic.properties.Read&&e.bleexplorer.currentCharacteristic.properties.Read.enabled&&e.bleexplorer.currentCharacteristic.readValue(function(r,t){i=t,e.changeFormat()}),e.changeFormat=function(){switch(e.readformat){case"ASCII":e.currentValue=t.hex2a(i);break;case"Int":e.currentValue=t.hex2dec(i);break;case"Binary":e.currentValue=t.hex2b(i);break;default:e.currentValue=i}e.$$phase||e.$apply()},e.writeValue=function(){var r="";if(""!==e.inputs&&null!==e.inputs&&void 0!==e.inputs)switch(e.writeformat){case"ASCII":r=t.a2hex(e.inputs),e.bleexplorer.currentCharacteristic.writeValue(function(r){e.bleexplorer.onSuccess("Successfully wrote the value ")},r);break;case"Int":r=t.dec2hex(e.inputs),e.bleexplorer.currentCharacteristic.writeValue(function(r){e.bleexplorer.onSuccess("Successfully wrote the value ")},r);break;case"Binary":r=e.inputs;break;default:r=e.inputs,t.isValidHex(r)?e.bleexplorer.currentCharacteristic.writeValue(function(r){e.bleexplorer.onSuccess("Successfully wrote the value ")},r):e.bleexplorer.showAlert("Entered Hex is Invalid.")}else e.bleexplorer.showAlert("Enter the value to write.")},e.readAgain=function(){e.bleexplorer.currentCharacteristic.properties.Read&&e.bleexplorer.currentCharacteristic.properties.Read.enabled&&e.bleexplorer.currentCharacteristic.readValue(function(r,t){i=t,e.changeFormat()})},e.notify=function(){var r="";e.bleexplorer.currentCharacteristic.on("valueChange",function(r){i=r.value,e.changeFormat()},r),e.bleexplorer.currentCharacteristic.enableNotifications(function(r,t){e.bleexplorer.isNotifying=t,e.$apply()},!0)},e.stopNotify=function(){e.bleexplorer.currentCharacteristic.enableNotifications(function(r,t){e.bleexplorer.isNotifying=t,e.$apply()},!1)},e.back=function(){history.go(-1)},e.gotologview=function(){window.location="gatt-ip://logview"}}]),app.controller("devicelistCtrl",["$scope","$state","$stateParams","$mdDialog","$mdToast","$mdBottomSheet",function(e,r,t,i,n,l){function o(){e.bleexplorer.currentPeripheral=null,e.perip_connect=!1,e.isScanning=!1,e.bleexplorer.scanned_perips=[],e.bleexplorer._currentgateway.stopScan(function(){e.bleexplorer.showLoadingIndicator("","Scanning for Peripherals...."),e.bleexplorer._currentgateway.scan(function(){e.bleexplorer._currentgateway.on("scan",e.bleexplorer.onScan)})})}function a(){e.bleexplorer.onError("Peripheral disconnected."),o()}isGattipApp&&(e.isGattipApp=!0),initialiseGattip(),e.bleexplorer=bleexplorer;var c=new Util;e.scanOption="Stop Scan",e.showOption="Stop Scan",e.userFilters="No Filters",e.isScanning=!1,e.bleexplorer.scanned_perips=[],e.bleexplorer.filterScan=!1,e.bleexplorer.filtername="",e.bleexplorer.filteruuid="",e.bleexplorer.currentPeripheral&&e.bleexplorer.currentPeripheral.disconnect(function(e){a()}),e.bleexplorer.onSuccess=function(e){n.show(n.simple().textContent(e).position("top").theme("success-toast").hideDelay(2500))},e.bleexplorer.onError=function(e){n.show(n.simple().textContent(e).position("top").theme("error-toast").hideDelay(2500))},e.bleexplorer.scanStarts=function(r){e.bleexplorer.showLoadingIndicator("","Scanning for Peripherals....")},e.bleexplorer.mainState=function(){r.go("devicelist")},e.bleexplorer.stopScanEvent=function(r,t){e.perip_connect=!1,e.isScanning=!1,e.bleexplorer.scanned_perips=[],e.scanOption="Scan",e.showOption="Scan",""!==r&&"undefined"!=typeof r?(e.userFilters=r,""!==t&&"undefined"!=typeof t&&(e.userFilters=e.userFilters+" "+t)):""!==t&&"undefined"!=typeof t?e.userFilters=t:e.userFilters="No Filters"},e.openMenu=function(r,t){"Stop Scan"===e.showOption?e.scanStopScan():r(t)},e.scanStopScan=function(){e.bleexplorer.filterScan=!1,e.isScanning?e.bleexplorer._currentgateway.stopScan(function(){e.isScanning=!1,e.scanOption="Scan",e.showOption="Options",e.$apply()}):(e.bleexplorer.currentPeripheral=null,e.perip_connect=!1,e.isScanning=!1,e.bleexplorer.scanned_perips=[],e.bleexplorer.filtername="",e.bleexplorer.filteruuid="",e.bleexplorer.stopScanEvent(),e.bleexplorer.showLoadingIndicator("","Scanning for Peripherals...."),e.bleexplorer._currentgateway.scan(function(){e.scanOption="Stop Scan",e.showOption="Stop Scan",e.$apply(),e.bleexplorer._currentgateway.on("scan",e.bleexplorer.onScan)}))},e.sortByName=function(){e.showOption="Sort by Name",e.bleexplorer.scanned_perips.sort(function(e,r){return e.name>r.name?1:r.name>e.name?-1:0})},e.sortByRSSI=function(){e.showOption="Sort by Near",e.bleexplorer.scanned_perips.sort(function(e,r){return Math.abs(e.rssi)>Math.abs(r.rssi)?1:-1})},e.bleexplorer.onScan=function(r){e.scanOption="Stop Scan",e.showOption="Stop Scan",e.isScanning||(e.isScanning=!0,e.devices_align=!0,setTimeout(function(){e.devices_align=!1},3e3)),c.updatesignalimage(r),r.advdata&&void 0!==r.advdata.txPowerLevel?r.txpowerLevel=r.advdata.txPowerLevel:r.txpowerLevel=r.txPowerLevel,r.advdata&&r.advdata.serviceUUIDs.length>0?r.serviceUUIDs=r.advdata.serviceUUIDs:r.serviceUUIDs=r.getAllAdvertisedServiceUUIDs();var t=e.bleexplorer.filtername,i=e.bleexplorer.filteruuid,n=[];if(""!==i&&"undefined"!=typeof i){n=i.trim().split(/\s*,\s*/);for(var l=0;l<n.length;l++)n[l]=n[l].toUpperCase()}var o=!1,a=0;if(n.length>0&&""!==t&&"undefined"!=typeof t){if(n.length>0){for(var s=0;s<n.length;s++)"undefined"!=typeof r.serviceUUIDs&&r.serviceUUIDs.length>0&&r.serviceUUIDs.indexOf(n[s])>-1&&a++;a>0&&(o=!0),o&&(r.name.toUpperCase()===t.toUpperCase()||r.name.toUpperCase().indexOf(t.toUpperCase())>-1)&&(e.bleexplorer.scanned_perips=c.pushUniqueObj(e.bleexplorer.scanned_perips,r),e.bleexplorer.filter_scanned_perips=c.pushUniqueObj(e.bleexplorer.filter_scanned_perips,r),e.bleexplorer.filterFound=!0,e.bleexplorer.isShowingLoadingIndic&&e.bleexplorer.hideDialog())}}else if(n.length>0||""!==t&&"undefined"!=typeof t){if(n.length>0){for(var p=0;p<n.length;p++)"undefined"!=typeof r.serviceUUIDs&&r.serviceUUIDs.length>0&&r.serviceUUIDs.indexOf(n[p])>-1&&a++;a>0&&(o=!0),o&&(e.bleexplorer.scanned_perips=c.pushUniqueObj(e.bleexplorer.scanned_perips,r),e.bleexplorer.filter_scanned_perips=c.pushUniqueObj(e.bleexplorer.filter_scanned_perips,r),e.bleexplorer.filterFound=!0,e.bleexplorer.isShowingLoadingIndic&&e.bleexplorer.hideDialog())}""!==t&&"undefined"!=typeof t&&(r.name.toUpperCase()===t.toUpperCase()||r.name.toUpperCase().indexOf(t.toUpperCase())>-1)&&(e.bleexplorer.scanned_perips=c.pushUniqueObj(e.bleexplorer.scanned_perips,r),e.bleexplorer.filter_scanned_perips=c.pushUniqueObj(e.bleexplorer.filter_scanned_perips,r),e.bleexplorer.filterFound=!0,e.bleexplorer.isShowingLoadingIndic&&e.bleexplorer.hideDialog())}else e.bleexplorer.filterScan=!1,e.bleexplorer.scanned_perips=c.pushUniqueObj(e.bleexplorer.scanned_perips,r),e.bleexplorer.isShowingLoadingIndic&&e.bleexplorer.hideDialog();e.devices_align&&e.bleexplorer.scanned_perips.sort(function(e,r){return Math.abs(e.rssi)>Math.abs(r.rssi)?1:-1}),e.perip_connect=!1,e.bleexplorer.scanned_perips_length=e.bleexplorer.scanned_perips.length,"undefined"!=typeof e.bleexplorer.filter_scanned_perips&&(e.bleexplorer.filter_scanned_perips_length=e.bleexplorer.filter_scanned_perips.length),e.$apply()},e.showAdvInfoDialog=function(e,r){i.show({controller:DeviceInfoController,templateUrl:"views/device_info.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,locals:{peripheral:r}})},e.bleexplorer.showLoadingIndicator=function(e,r){i.show({controller:LoadingIndicatorController,templateUrl:"views/loading.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!1,locals:{loadingText:r}})},e.bleexplorer.showAlert=function(e,r){i.show({controller:alertDialogController,templateUrl:"views/alert.html",parent:angular.element(document.body),targetEvent:r,clickOutsideToClose:!1,locals:{alertText:e}})},e.bleexplorer.hideDialog=function(){e.bleexplorer.isShowingLoadingIndic=!1,i.cancel()},e.showfilterOptions=function(){e.alert="",l.show({templateUrl:"views/filter.html",controller:"filterCtrl"})},e.connectPeripheral=function(t){t.once("connected",function(e){}),t.once("disconnected",function(t){e.bleexplorer.currentPeripheral&&(a(),r.go("devicelist"))});var i=!1;i=t.advdata&&void 0!==t.advdata?t.advdata.discoverable:!t.discoverable||void 0===t.discoverable||t.discoverable,i!==!1?e.bleexplorer._currentgateway.stopScan(function(){e.isScanning=!1,e.scanOption="Scan",e.showOption="Options",e.bleexplorer.showLoadingIndicator("","Connecting to Peripheral...."),t.connect(function(){e.bleexplorer.currentPeripheral=t,e.perip_connect=!0,e.bleexplorer.currentPeripheral.services=t.getAllServices(),r.go("servicelist"),e.bleexplorer.isShowingLoadingIndic&&e.bleexplorer.hideDialog()})}):e.bleexplorer.showAlert("Selected device is not connectable")},e.gotoremoteview=function(){window.location="gatt-ip://remoteview"},e.gotologview=function(){window.location="gatt-ip://logview"},e.bleexplorer.stopScanEvent()}]),app.controller("filterCtrl",["$scope","$mdBottomSheet","$timeout","$mdDialog",function(e,r,t,i){e.bleexplorer=bleexplorer,e.filter_name=e.bleexplorer.filtername,e.filter_serv_uuid=e.bleexplorer.filteruuid,e.bleexplorer.filterFound=!1;new Util;e.clearFilterName=function(){e.filter_name=""},e.clearFilterUUID=function(){e.filter_serv_uuid=""},e.showNoDeviceFoundDialog=function(e,r){i.show({controller:NoDeviceFoundController,templateUrl:"views/no_device_found.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!1})},e.scanPeripsWithFilters=function(){e.bleexplorer.filtername=e.filter_name,e.bleexplorer.filteruuid=e.filter_serv_uuid,e.bleexplorer.filterScan=!0,e.bleexplorer.filter_scanned_perips=[],e.bleexplorer.stopScanEvent(e.bleexplorer.filtername,e.bleexplorer.filteruuid),e.bleexplorer.showLoadingIndicator("","Filtering scanned Peripherals...."),t(function(){(void 0===e.bleexplorer.filter_scanned_perips_length||e.bleexplorer.filter_scanned_perips_length<1)&&e.bleexplorer.filterFound===!1&&(e.bleexplorer.showNoDeviceFoundDialog(),e.bleexplorer.filterFound=!1,e.bleexplorer.filterScan=!1)},7e3),r.hide()}}]),app.controller("servicelistCtrl",["$scope","$state","$timeout",function(e,r,t){isGattipApp&&(e.isGattipApp=!0),e.bleexplorer=bleexplorer;var i=new Util;e.discoverCharacteristics=function(n){function l(r,n){e.bleexplorer.currentService.characteristics[r.characteristic().uuid].characteristicName=i.hex2a(n),e.$apply(),t()}e.bleexplorer.currentService=n,e.bleexplorer.currentService.characteristics=n.getAllCharacteristics();for(var o in e.bleexplorer.currentService.characteristics)e.bleexplorer.currentService.characteristics[o].properties=e.bleexplorer.currentService.characteristics[o].allProperties();var a=[];for(var c in e.bleexplorer.currentService.characteristics)a.push(e.bleexplorer.currentService.characteristics[c]),e.bleexplorer.currentService.characteristics[c].descriptors=e.bleexplorer.currentService.characteristics[c].getAllDescriptors();a.length>0&&!function e(r){setTimeout(function(){var t=a[r].getAllDescriptors();for(var i in t)if(i.indexOf("2901")>-1){t[i].readValue(function(e,r){l(e,r)});break}r--&&e(r)},200)}(a.length-1),r.go("characteristiclist")},e.back=function(){history.go(-1)},e.gotologview=function(){window.location="gatt-ip://logview"}}]);var url="ws://localhost:6001",GATTIP=require("gatt-ip").GATTIP,isGattipApp=!1;