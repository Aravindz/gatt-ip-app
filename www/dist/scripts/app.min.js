function connectWithPort(t){return url="ws://localhost:"+t}function Util(){return this.updatesignalimage=function(t){return t.image=Math.abs(t.rssi)<10?"images/signal_5.png":Math.abs(t.rssi)<30?"images/signal_4.png":Math.abs(t.rssi)<50?"images/signal_3.png":Math.abs(t.rssi)<70?"images/signal_2.png":"images/signal_1.png",t},this.hex2a=function(t){for(var e=t.toString(),i="",n=0;n<e.length;n+=2)i+=String.fromCharCode(parseInt(e.substr(n,2),16));return i},this.hex2dec=function(t){return parseInt(t,16)},this.hex2b=function(t){var e=hex2i(t);return e.toString(2)},this.a2hex=function(t){var e="";for(a=0;a<t.length;a++)e+=t.charCodeAt(a).toString(16);return e},this.dec2hex=function(t){for(var e=Number(t).toString(16);e.length<2;)e="0"+e;return e},this}var app=angular.module("GATT-IP",["ngRoute"]).config(["$routeProvider",function(t){t.when("/devicelist",{templateUrl:"views/devicelist.html",controller:"devicelistController"}),t.when("/servicelist",{templateUrl:"views/servicelist.html",controller:"servicelistController"}),t.when("/characteristiclist",{templateUrl:"views/characteristiclist.html",controller:"characteristiclistController"}),t.when("/descriptorlist",{templateUrl:"views/descriptorlist.html",controller:"descriptorlistController"}),t.otherwise({redirectTo:"/devicelist"})}]);app.controller("characteristiclistController",["$scope","gattip",function(t,e){t.gattip=e,t.discoverDescriptors=function(t){t.discoverDescriptors()},t.back=function(){history.go(-1)},t.gotologview=function(){window.location="gatt-ip://logview"}}]),app.controller("descriptorlistController",["$scope","gattip",function(t,e){function i(){switch(t.readformat){case"1":t.currentValue=n.hex2a(e.currentCharacteristic.value);break;case"2":t.currentValue=n.hex2dec(e.currentCharacteristic.value);break;case"3":t.currentValue=n.hex2b(e.currentCharacteristic.value);break;default:t.currentValue=e.currentCharacteristic.value}}t.gattip=e;var n=Util();t.readformat=0,t.writeformat=0,t.$watch("gattip.currentCharacteristic.value",i),t.changeFormat=i,t.writeValue=function(){var i="";switch(t.writeformat){case"1":i=n.a2hex(t.inputs);break;case"2":i=n.dec2hex(t.inputs);break;case"3":i=t.inputs;break;default:i=t.inputs}e.currentCharacteristic.write(i)},t.readAgain=function(){e.currentCharacteristic.read()},t.notify=function(){e.currentCharacteristic.notify(!0)},t.stopNotify=function(){e.currentCharacteristic.notify(!1)},t.back=function(){history.go(-1)},t.gotologview=function(){window.location="gatt-ip://logview"}}]),app.controller("devicelistController",["$scope","gattip",function(t,e){t.gattip=e,t.connectPeripheral=function(t){t.connect()},t.gotoremoteview=function(){window.location="gatt-ip://remoteview"},t.gotologview=function(){window.location="gatt-ip://logview"},$(document).ready(function(){var i,n,r,o=$(".PullToRefresh"),c=!1,a=document.documentElement;$.each(o,function(o,s){s.addEventListener("touchstart",function(t){$(".pull").hide(),contentStartY=$(".iscroll-scroller").position().top,i=t.touches[0].screenY,r=(window.pageXOffset||a.scrollLeft)-(a.clientLeft||0),n=(window.pageYOffset||a.scrollTop)-(a.clientTop||0)}),s.addEventListener("touchend",function(){$(".pull").html("Pull Down").hide(),c&&(s.style["-webkit-transition-duration"]=".5s",t.$apply(function(){e.peripherals={}}),e.scan(!0),s.addEventListener("transitionEnd",l),c=!1)}),s.addEventListener("touchmove",function(t){if(t.preventDefault(),contentStartY>=0){if(t.changedTouches[0].screenY-i>15&&$(".pull").html("Pull Down").show(),!(0===n&&t.changedTouches[0].screenY-i>80&&contentStartY>=0))return c=!1,!1;$(".pull").html("Release to Refresh").show(),c=!0}});var l=function(){content.style["-webkit-transition-duration"]=0}}),document.addEventListener("touchend",function(){$(".pull").html("Pull down").hide()},!1)})}]),app.controller("servicelistController",["$scope","gattip",function(t,e){t.gattip=e,t.discoverCharacteristics=function(t){t.discoverCharacteristics()},t.back=function(){e.currentPeripheral&&e.currentPeripheral.disconnect(),history.go(-1)},t.gotologview=function(){window.location="gatt-ip://logview"}}]);var url="ws://localhost:6001";app.factory("gattip",["$q","$rootScope","$location",function(t,e,i){alert("Stop for debugger....");var n=Util(),r=new GATTIP;return r.init(url),r.oninit=function(){r.configure(!0)},r.onstate=function(){r.state===GATTIP.kPoweredOn?r.scan(!0):r.state===GATTIP.kPoweredOff?e.$apply(function(){i.path("/devicelist")}):r.state===GATTIP.kUnsupported&&alert("Bluetooth Low Energy is not supported with this device.")},r.onscan=function(t){n.updatesignalimage(t),e.$apply()},r.onconnect=function(t){r.currentPeripheral=t,t.discoverServices()},r.ondisconnect=function(t,n){r.currentPeripheral=null,n&&n.message&&alert(n.message),e.$apply(function(){i.path("/devicelist")})},r.ondiscoverServices=function(){e.$apply(function(){i.path("/servicelist")})},r.ondiscoverCharacteristics=function(t,n){r.currentService=n,e.$apply(function(){i.path("/characteristiclist")})},r.ondiscoverDescriptors=function(t,n,o){r.currentCharacteristic=o,o.read(),e.$apply(function(){i.path("/descriptorlist")})},r.onupdateValue=function(){e.$apply()},r.onwriteValue=function(){e.$apply()},r}]);